<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>

<body>

    <main class="main-login-cad">
        <div class="banner-login">
            <h1><a href="/"><img src="https://i.ibb.co/KVZRVhw/logov4-preto.png" alt="logo-em-obra"
                        class="logo-header"></a></h1>
            <h3>Facilitando conexões, <br>concretizando projetos.</h3>
        </div>

        <div class="login-container">
            <div class="form-login">
                <h1>Login</h1>

                <!-- Mensagem de ativação -->
                <div id="message" class="alert alert-info" style="display: none;"></div>

                <form id="loginForm">
                    <div class="input-control-login">
                        <label for="identifier" class="text">CPF ou Email</label>
                        <input type="text" id="identifier" name="identifier" placeholder="Digite seu email ou CPF"
                            required class="input">
                    </div>

                    <div class="input-control-login">
                        <label for="senha" class="text">Senha</label>
                        <input type="password" id="senha" name="senha" placeholder="Digite sua senha" required
                            class="input">
                    </div>

                    <div class="manter-conectado">
                        <div>
                            <input type="checkbox" id="conectado" name="conectado">
                            <label for="conectado">Manter-se conectado</label>
                        </div>
                    </div>

                    <button type="submit" class="botao-entrar">Entrar</button>
                </form>

                <div>
                    <a href="/register" class="outras-acoes-login">Cadastre-se</a>
                    <a href="#" class="outras-acoes-login">Esqueceu sua senha?</a>
                </div>
            </div>
        </div>

    </main>

    <script>
        // Captura a mensagem da URL
        const urlParams = new URLSearchParams(window.location.search);
        const message = urlParams.get('message');
        if (message) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerText = message;
            messageDiv.style.display = 'block';
        }

        // Função de login via AJAX
        document.getElementById('loginForm').addEventListener('submit', async function (event) {
            event.preventDefault();  // Evita o envio padrão do formulário

            const identifier = document.getElementById('identifier').value;
            const senha = document.getElementById('senha').value;

            try {
                const response = await fetch('/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ identifier, senha })
                });

                if (response.redirected) {
                    // Se o back-end fizer o redirecionamento, o navegador o seguirá
                    window.location.href = response.url;
                } else {
                    const errorMessage = await response.text();
                    showMessage(errorMessage, 'alert-danger');
                }
            } catch (error) {
                console.error('Erro na tentativa de login:', error);
                showMessage('Erro ao tentar se conectar. Tente novamente mais tarde.', 'alert-danger');
            }
        });

        // Função para exibir mensagens de erro ou sucesso
        function showMessage(message, alertClass) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerText = message;
            messageDiv.className = `alert ${alertClass}`;
            messageDiv.style.display = 'block';
        }
    </script>

</body>

</html>
